<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ å›½å®¶æ„å¿—æ¨¡æ‹Ÿå™¨</title>
  <style>
    /* é¡µé¢æ•´ä½“æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #0d1b2a, #1b263b);
      color: #e0e1dd;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }
    
    .container {
      width: 100%;
      max-width: 500px;
      background: rgba(23, 32, 45, 0.95);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
      overflow: hidden;
      border: 1px solid #415a77;
    }
    
    h2 {
      text-align: center;
      margin-bottom: 15px;
      color: #e0e1dd;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    /* é¢æ¿æ ·å¼ */
    .panel {
      background: rgba(31, 48, 68, 0.8);
      border-radius: 10px;
      margin-bottom: 15px;
      padding: 15px;
      font-size: 0.9rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      border: 1px solid #415a77;
    }
    
    .panel-title {
      font-weight: bold;
      color: #a9b6c2;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    /* çŠ¶æ€é¢æ¿æ ·å¼ */
    .status-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    
    .stat-item {
      background: rgba(26, 40, 55, 0.6);
      padding: 8px;
      border-radius: 8px;
      border-left: 3px solid #778da9;
    }
    
    .stat-value {
      font-weight: bold;
      color: #e0e1dd;
      margin-top: 3px;
    }
    
    .progress-bar {
      height: 8px;
      background: #1b263b;
      border-radius: 4px;
      margin-top: 5px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4cc9f0, #4895ef);
      border-radius: 4px;
    }
    
    /* é€‰é¡¹åŒºåŸŸæ ·å¼ */
    .options {
      max-height: 300px;
      overflow-y: auto;
      padding: 5px;
      margin-bottom: 10px;
    }
    
    .option-item {
      background: rgba(31, 48, 68, 0.7);
      border-radius: 8px;
      margin-bottom: 12px;
      padding: 15px;
      border: 1px solid #415a77;
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .option-item:hover {
      background: rgba(41, 58, 78, 0.9);
      transform: translateY(-2px);
      border-color: #4cc9f0;
    }
    
    /* é€‰ä¸­çŠ¶æ€çš„é«˜äº®æ ·å¼ */
    .option-item.selected {
      background: rgba(41, 58, 78, 0.95);
      border: 2px solid #4cc9f0;
      box-shadow: 0 0 10px rgba(76, 201, 240, 0.5);
    }
    
    .option-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .option-title {
      font-weight: bold;
      color: #e0e1dd;
      font-size: 1.05rem;
    }
    
    .option-labor {
      background: #415a77;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.9rem;
      min-width: 80px;
      text-align: center;
    }
    
    .option-desc {
      font-size: 0.9rem;
      color: #a9b6c2;
      margin-bottom: 10px;
      line-height: 1.4;
    }
    
    .option-cost {
      font-size: 0.85rem;
      color: #ff9e80;
      display: flex;
      justify-content: space-between;
      padding-top: 8px;
      border-top: 1px dashed #415a77;
    }
    
    /* æŒ‰é’®æ ·å¼ */
    button {
      background: linear-gradient(to right, #415a77, #778da9);
      color: white;
      width: 100%;
      border: none;
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: bold;
      transition: all 0.3s;
      box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
      font-size: 1rem;
    }
    
    button:hover {
      background: linear-gradient(to right, #4cc9f0, #4895ef);
      transform: translateY(-2px);
      box-shadow: 0 5px 8px rgba(0, 0, 0, 0.3);
    }
    
    button:disabled {
      background: #415a77;
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* åŠ³åŠ¨åŠ›æ‘˜è¦ */
    .labor-summary {
      text-align: center;
      font-size: 1rem;
      background: rgba(31, 48, 68, 0.7);
      padding: 12px;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid #415a77;
    }
    
    .labor-warning {
      color: #e63946;
      font-weight: bold;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    
    /* èŠå¤©åŒºåŸŸ */
    #chat {
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      margin-top: 15px;
      background: rgba(26, 40, 55, 0.6);
      border-radius: 8px;
    }
    
    .chat-message {
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 6px;
      background: rgba(31, 48, 68, 0.5);
      border-left: 3px solid #415a77;
      line-height: 1.5;
    }
    
    .chat-message.event {
      border-left-color: #e63946;
      background: rgba(230, 57, 70, 0.15);
    }
    
    .chat-message.ai {
      border-left-color: #90e0ef;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 500px) {
      .container {
        padding: 15px;
      }
      
      .status-grid {
        grid-template-columns: 1fr;
      }
      
      .options {
        max-height: 250px;
      }
      
      .option-item {
        padding: 12px;
      }
      
      .option-title {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h2>ğŸŒ å›½å®¶æ„å¿—æ¨¡æ‹Ÿå™¨</h2>
  
  <!-- çŠ¶æ€é¢æ¿ -->
  <div class="panel" id="statusPanel">
    <div class="panel-title">ğŸ“Š ç¤¾ä¼šçŠ¶æ€</div>
    <div class="status-grid">
      <div class="stat-item">
        <div>äººå£</div>
        <div class="stat-value" id="populationValue">60</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 60%"></div>
        </div>
      </div>
      <div class="stat-item">
        <div>é£Ÿç‰©</div>
        <div class="stat-value" id="foodValue">70</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 35%"></div>
        </div>
      </div>
      <div class="stat-item">
        <div>å·¥å…·</div>
        <div class="stat-value" id="toolsValue">20</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 20%"></div>
        </div>
      </div>
      <div class="stat-item">
        <div>æŠ€æœ¯</div>
        <div class="stat-value" id="techValue">3</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 30%"></div>
        </div>
      </div>
      <div class="stat-item">
        <div>æ–‡åŒ–</div>
        <div class="stat-value" id="cultureValue">2</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 20%"></div>
        </div>
      </div>
      <div class="stat-item">
        <div>å£«æ°”</div>
        <div class="stat-value" id="moraleValue">85</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 85%"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- å±€åŠ¿é¢æ¿ -->
  <div class="panel" id="situationPanel">
    <div class="panel-title">ğŸ“ å½“å‰å±€åŠ¿</div>
    <div class="stat-item">
      <div>å­£åº¦</div>
      <div class="stat-value" id="seasonValue">1</div>
    </div>
    <div class="stat-item">
      <div>ä½ç½®</div>
      <div class="stat-value" id="locationValue">æ£®æ—è¾¹ç¼˜</div>
    </div>
    <div class="stat-item">
      <div>ç¤¾ä¼šå½¢æ€</div>
      <div class="stat-value" id="formValue">åŸå§‹éƒ¨è½</div>
    </div>
    <div class="stat-item">
      <div>ç»„ç»‡</div>
      <div class="stat-value" id="orgValue">éƒ¨è½è®®ä¼š</div>
    </div>
    <div class="stat-item">
      <div>å¯ç”¨åŠ³åŠ¨åŠ›</div>
      <div class="stat-value" id="laborValue">48</div>
    </div>
  </div>
  
  <!-- é€‰é¡¹é¢æ¿ -->
  <div class="panel">
    <div class="panel-title">âš™ï¸ å‘å±•é€‰é¡¹</div>
    <div class="options" id="optionsPanel"></div>
    
    <div class="labor-summary" id="laborSummary">
      å·²é€‰æ‹©: <span id="selectedCount">0</span> é¡¹ | 
      æ¶ˆè€—: <span id="totalCost">0</span> åŠ³åŠ¨åŠ›
    </div>
    
    <button id="submitBtn">âœ… æ‰§è¡Œé€‰æ‹©</button>
  </div>
  
  <!-- èŠå¤©/äº‹ä»¶é¢æ¿ -->
  <div class="panel" id="chat"></div>
</div>

<script>
// æ¸¸æˆçŠ¶æ€å¯¹è±¡ - å­˜å‚¨æ‰€æœ‰æ¸¸æˆæ•°æ®
const state = {
  population: 60, 
  tools: 20, 
  food: 70, 
  water: 80, 
  morale: 85,
  tech: 3, 
  culture: 2, 
  belief: 'å›¾è…¾ç¥­ç¥€', 
  economy: 1,
  org: 'éƒ¨è½è®®ä¼š', 
  form: 'åŸå§‹éƒ¨è½', 
  season: 1, 
  location: 'æ£®æ—è¾¹ç¼˜', 
  starving: false,
  availableLabor: 48
};

// è¡ŒåŠ¨é€‰é¡¹å®šä¹‰
const actions = {
  // æŠ€æœ¯å‘å±•ç±»
  sharpStoneTools: { title: 'ğŸ—¿ åŸå§‹å·¥å…·æ”¹è¿›', desc: 'åˆ¶ä½œæ›´é”‹åˆ©çš„çŸ³å™¨ï¼Œæå‡ç‹©çŒæ•ˆç‡', labor: 10, exec(){state.tools+=10;} },
  controlFire: { title: 'ğŸ”¥ ç«çš„æ§åˆ¶', desc: 'å»ºç«‹æ°¸ä¹…ç«æºï¼Œæå‡é£Ÿç‰©ä¿å­˜å’Œé˜²å¾¡èƒ½åŠ›', labor: 15, exec(){state.food+=10; state.morale+=5;} },
  weavingTech: { title: 'ğŸ§º ç¼–ç»‡æŠ€æœ¯', desc: 'åˆ¶ä½œæ¤ç‰©çº¤ç»´å®¹å™¨ï¼Œæé«˜é£Ÿç‰©å‚¨å­˜', labor: 8, exec(){state.food+=15;} },
  primitiveAgriculture: { title: 'ğŸŒ¾ åŸå§‹å†œä¸š', desc: 'å°è¯•ç§æ¤è°·ç‰©ï¼Œå¼€å¯å†œä¸šæŠ€æœ¯', labor: 20, exec(){state.tech+=2; state.food+=20;} },
  fishingTech: { title: 'ğŸ£ æ•é±¼æŠ€æœ¯', desc: 'åˆ¶ä½œæ¸”ç½‘ï¼Œå¢åŠ é£Ÿç‰©å¤šæ ·æ€§', labor: 12, exec(){state.food+=25;} },

  // ç¤¾ä¼šç»„ç»‡ç±»
  tribalDivision: { title: 'ğŸ‘¥ éƒ¨è½åˆ†å·¥', desc: 'åˆ†é…å°ç»„ï¼Œæé«˜æ•ˆç‡', labor: 10, exec(){state.tech+=1;} },
  tribalCouncil: { title: 'ğŸ›ï¸ å»ºç«‹éƒ¨è½ä¼šè®®', desc: 'å½¢æˆå†³ç­–æœºåˆ¶', labor: 15, exec(){state.culture+=2;} },
  hierarchySystem: { title: 'ğŸ”º é•¿å¹¼å°Šå‘', desc: 'å»ºç«‹ç­‰çº§åˆ¶åº¦', labor: 12, exec(){state.morale-=5; state.culture+=2;} },
  marriageSystem: { title: 'ğŸ’‘ å©šå§»åˆ¶åº¦', desc: 'è§„èŒƒå©šé…å…³ç³»ï¼Œå¢åŠ äººå£', labor: 8, exec(){state.population+=5;} },
  tribalRituals: { title: 'ğŸ‰ éƒ¨è½ä»ªå¼', desc: 'å»ºç«‹ä»ªå¼ï¼Œæé«˜å‡èšåŠ›', labor: 10, exec(){state.morale+=10; state.culture+=1;} },

  // èµ„æºç®¡ç†ç±»
  foodStorage: { title: 'ğŸ– é£Ÿç‰©å‚¨å­˜', desc: 'å»ºé€ å‚¨è—å®¤', labor: 15, exec(){state.food+=30;} },
  waterProtection: { title: 'ğŸ’§ æ°´æºä¿æŠ¤', desc: 'ä¿æŠ¤æ°´æºï¼Œå¢åŠ å¥åº·', labor: 12, exec(){state.morale+=5;} },
  resourceExploration: { title: 'â›ï¸ èµ„æºå‹˜æ¢', desc: 'å¯»æ‰¾çŸ¿æº', labor: 18, exec(){state.tools+=15;} },
  seasonalMigration: { title: 'ğŸŒ å­£èŠ‚è¿ç§»', desc: 'å»ºç«‹å†¬å¤è¥åœ°', labor: 20, exec(){state.morale+=15;} },

  // é˜²å¾¡ä¸æ‰©å¼ ç±»
  campDefense: { title: 'ğŸ›¡ï¸ è¥åœ°é˜²å¾¡', desc: 'å»ºé€ å›´æ ', labor: 15, exec(){state.morale+=10;} },
  weaponMaking: { title: 'ğŸ¹ æ­¦å™¨åˆ¶ä½œ', desc: 'åˆ¶ä½œçŸ›å’ŒæŠ•æ·æ£’', labor: 12, exec(){state.tools+=10; state.morale+=5;} },
  areaScouting: { title: 'ğŸ—ºï¸ ä¾¦å¯Ÿå‘¨è¾¹', desc: 'ç»˜åˆ¶åœ°å›¾', labor: 10, exec(){state.tech+=1;} },
  tribeExpansion: { title: 'ğŸï¸ éƒ¨è½æ‰©å¼ ', desc: 'å¸çº³å°ç¾¤ä½“', labor: 25, exec(){state.population+=10; state.morale-=5;} },

  // æ–‡åŒ–ä¿¡ä»°ç±»
  natureWorship: { title: 'ğŸŒ³ è‡ªç„¶å´‡æ‹œ', desc: 'å»ºç«‹ç¥­ç¥€åœ°ç‚¹', labor: 15, exec(){state.belief='è‡ªç„¶å´‡æ‹œ';} },
  ancestorWorship: { title: 'ğŸ—¿ ç¥–å…ˆå´‡æ‹œ', desc: 'å»ºç«‹ç¥­å›', labor: 12, exec(){state.culture+=2;} },
  rockArt: { title: 'ğŸ¨ å²©ç”»è‰ºæœ¯', desc: 'ç»˜åˆ¶å£ç”»', labor: 8, exec(){state.culture+=1;} },
  mythologyCreation: { title: 'ğŸ“– ç¥è¯ä¼ è¯´', desc: 'åˆ›é€ èµ·æºæ•…äº‹', labor: 10, exec(){state.morale+=5;} }
};

// åˆå§‹åŒ–æ¸¸æˆ
function initGame() {
  updatePanels();
  showOptions();
  appendChat("ğŸŒ± æ¸¸æˆå¼€å§‹ï¼šä½ æ˜¯ä¸€ä¸ªåŸå§‹éƒ¨è½çš„é›†ä½“æ„å¿—");
  appendChat("éƒ¨è½ä½äºæ£®æ—è¾¹ç¼˜ï¼Œæ‹¥æœ‰60äººå£å’ŒåŸºæœ¬çš„ç”Ÿå­˜æŠ€èƒ½", "ai");
}

// æ›´æ–°æ‰€æœ‰é¢æ¿æ˜¾ç¤º
function updatePanels() {
  // è®¡ç®—å¯ç”¨åŠ³åŠ¨åŠ›
  state.availableLabor = Math.floor(state.population * 0.8);
  
  // æ›´æ–°çŠ¶æ€é¢æ¿
  document.getElementById("populationValue").textContent = state.population;
  document.getElementById("foodValue").textContent = state.food;
  document.getElementById("toolsValue").textContent = state.tools;
  document.getElementById("techValue").textContent = state.tech;
  document.getElementById("cultureValue").textContent = state.culture;
  document.getElementById("moraleValue").textContent = state.morale;
  
  // æ›´æ–°è¿›åº¦æ¡
  document.querySelectorAll(".progress-fill")[0].style.width = `${state.population}%`;
  document.querySelectorAll(".progress-fill")[1].style.width = `${state.food/2}%`;
  document.querySelectorAll(".progress-fill")[2].style.width = `${state.tools}%`;
  document.querySelectorAll(".progress-fill")[3].style.width = `${state.tech*10}%`;
  document.querySelectorAll(".progress-fill")[4].style.width = `${state.culture*10}%`;
  document.querySelectorAll(".progress-fill")[5].style.width = `${state.morale}%`;
  
  // æ›´æ–°å±€åŠ¿é¢æ¿
  document.getElementById("seasonValue").textContent = state.season;
  document.getElementById("locationValue").textContent = state.location;
  document.getElementById("formValue").textContent = state.form;
  document.getElementById("orgValue").textContent = state.org;
  document.getElementById("laborValue").textContent = state.availableLabor;
}

// æ˜¾ç¤ºå¯ç”¨çš„è¡ŒåŠ¨é€‰é¡¹
function showOptions() {
  const optionsPanel = document.getElementById("optionsPanel");
  optionsPanel.innerHTML = "";
  
  // ä»æ‰€æœ‰é€‰é¡¹ä¸­éšæœºé€‰æ‹©5ä¸ªï¼Œç¡®ä¿åŠ³åŠ¨åŠ›æ€»å’Œåœ¨å¯ç”¨åŠ³åŠ¨åŠ›çš„1-2å€ä¹‹é—´
  const availableActions = Object.entries(actions);
  let selectedActions = [];
  let totalLabor = 0;
  let attempts = 0;
  const maxAttempts = 100;
  
  // å°è¯•æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„é€‰é¡¹ç»„åˆ
  while (selectedActions.length < 5 && attempts < maxAttempts) {
    // é‡ç½®å˜é‡
    selectedActions = [];
    totalLabor = 0;
    
    // åˆ›å»ºå¯ç”¨é€‰é¡¹çš„å‰¯æœ¬
    const tempActions = [...availableActions];
    
    // å°è¯•é€‰æ‹©5ä¸ªé€‰é¡¹
    while (selectedActions.length < 5 && tempActions.length > 0) {
      const idx = Math.floor(Math.random() * tempActions.length);
      const action = tempActions.splice(idx, 1)[0];
      const actionLabor = action[1].labor;
      
      // æ£€æŸ¥æ·»åŠ åæ˜¯å¦è¶…å‡º2å€é™åˆ¶
      if (totalLabor + actionLabor <= state.availableLabor * 2) {
        selectedActions.push(action);
        totalLabor += actionLabor;
      }
    }
    
    // æ£€æŸ¥æ˜¯å¦æ»¡è¶³å¤§äºå¯ç”¨åŠ³åŠ¨åŠ›çš„æ¡ä»¶
    if (totalLabor <= state.availableLabor) {
      attempts++;
      continue;
    }
    
    // å¦‚æœæ»¡è¶³æ¡ä»¶åˆ™è·³å‡ºå¾ªç¯
    if (totalLabor > state.availableLabor && totalLabor <= state.availableLabor * 2) {
      break;
    }
    
    attempts++;
  }
  
  // å¦‚æœæ‰¾ä¸åˆ°ç¬¦åˆæ¡ä»¶çš„ç»„åˆï¼Œåˆ™ä½¿ç”¨é»˜è®¤éšæœºé€‰æ‹©
  if (attempts >= maxAttempts) {
    selectedActions = [];
    totalLabor = 0;
    const tempActions = [...availableActions];
    
    while (selectedActions.length < 5 && tempActions.length > 0) {
      const idx = Math.floor(Math.random() * tempActions.length);
      selectedActions.push(tempActions.splice(idx, 1)[0]);
    }
  }
  
  // åˆ›å»ºé€‰é¡¹HTML
  selectedActions.forEach(([key, action]) => {
    const optionElement = document.createElement("div");
    optionElement.className = "option-item";
    optionElement.dataset.key = key;
    optionElement.dataset.labor = action.labor;
    optionElement.innerHTML = `
      <div class="option-header">
        <div class="option-title">${action.title}</div>
        <div class="option-labor">${action.labor} åŠ³åŠ¨åŠ›</div>
      </div>
      <div class="option-desc">${action.desc}</div>
      <div class="option-cost">
        <span>æ•ˆæœ: ${getEffectText(action.title)}</span>
        <span>é£é™©: ${getRiskText(action.title)}</span>
      </div>
    `;
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
    optionElement.addEventListener("click", function() {
      this.classList.toggle("selected");
      updateLaborSummary();
    });
    
    optionsPanel.appendChild(optionElement);
  });
  
  // æ›´æ–°åŠ³åŠ¨åŠ›æ‘˜è¦
  updateLaborSummary();
}

// è·å–é€‰é¡¹æ•ˆæœæ–‡æœ¬
function getEffectText(title) {
  if (title.includes('å·¥å…·')) return 'â†‘å·¥å…·æ•°é‡';
  if (title.includes('ç«')) return 'â†‘é£Ÿç‰©å‚¨å¤‡, â†‘å£«æ°”';
  if (title.includes('ç¼–ç»‡')) return 'â†‘é£Ÿç‰©å‚¨å¤‡';
  if (title.includes('å†œä¸š')) return 'â†‘æŠ€æœ¯, â†‘é£Ÿç‰©';
  if (title.includes('æ•é±¼')) return 'â†‘é£Ÿç‰©å‚¨å¤‡';
  if (title.includes('åˆ†å·¥')) return 'â†‘æŠ€æœ¯æ°´å¹³';
  if (title.includes('ä¼šè®®')) return 'â†‘æ–‡åŒ–æ°´å¹³';
  if (title.includes('å°Šå‘')) return 'â†‘æ–‡åŒ–, â†“å£«æ°”';
  if (title.includes('å©šå§»')) return 'â†‘äººå£';
  if (title.includes('ä»ªå¼')) return 'â†‘å£«æ°”, â†‘æ–‡åŒ–';
  if (title.includes('å‚¨å­˜')) return 'â†‘é£Ÿç‰©å‚¨å¤‡';
  if (title.includes('æ°´æº')) return 'â†‘å£«æ°”';
  if (title.includes('å‹˜æ¢')) return 'â†‘å·¥å…·æ•°é‡';
  if (title.includes('è¿ç§»')) return 'â†‘å£«æ°”';
  if (title.includes('é˜²å¾¡')) return 'â†‘å£«æ°”';
  if (title.includes('æ­¦å™¨')) return 'â†‘å·¥å…·, â†‘å£«æ°”';
  if (title.includes('ä¾¦å¯Ÿ')) return 'â†‘æŠ€æœ¯æ°´å¹³';
  if (title.includes('æ‰©å¼ ')) return 'â†‘äººå£, â†“å£«æ°”';
  if (title.includes('è‡ªç„¶å´‡æ‹œ')) return 'â†‘ä¿¡ä»°ä½“ç³»';
  if (title.includes('ç¥–å…ˆå´‡æ‹œ')) return 'â†‘æ–‡åŒ–æ°´å¹³';
  if (title.includes('å²©ç”»')) return 'â†‘æ–‡åŒ–æ°´å¹³';
  return 'â†‘å£«æ°”';
}

// è·å–é€‰é¡¹é£é™©æ–‡æœ¬
function getRiskText(title) {
  if (title.includes('æ‰©å¼ ') || title.includes('å°Šå‘')) return 'å¯èƒ½å¼•å‘å†²çª';
  if (title.includes('å†œä¸š') || title.includes('ç¼–ç»‡')) return 'å¯èƒ½å¤±è´¥';
  return 'æœªçŸ¥';
}

// æ›´æ–°åŠ³åŠ¨åŠ›æ‘˜è¦
function updateLaborSummary() {
  const selectedOptions = document.querySelectorAll(".option-item.selected");
  const selectedCount = selectedOptions.length;
  
  // è®¡ç®—æ€»åŠ³åŠ¨åŠ›æ¶ˆè€—
  let totalLabor = 0;
  selectedOptions.forEach(option => {
    totalLabor += parseInt(option.dataset.labor);
  });
  
  // æ›´æ–°æ˜¾ç¤º
  document.getElementById("selectedCount").textContent = selectedCount;
  document.getElementById("totalCost").textContent = totalLabor;
  
  // æ£€æŸ¥æ˜¯å¦è¶…è¿‡å¯ç”¨åŠ³åŠ¨åŠ›
  const laborSummary = document.getElementById("laborSummary");
  if (totalLabor > state.availableLabor) {
    laborSummary.classList.add("labor-warning");
  } else {
    laborSummary.classList.remove("labor-warning");
  }
}

// æ·»åŠ èŠå¤©ä¿¡æ¯
function appendChat(message, type = "normal") {
  const chatPanel = document.getElementById("chat");
  const messageElement = document.createElement("div");
  messageElement.className = `chat-message ${type === "event" ? "event" : type === "ai" ? "ai" : ""}`;
  messageElement.textContent = message;
  chatPanel.appendChild(messageElement);
  
  // æ»šåŠ¨åˆ°åº•éƒ¨
  chatPanel.scrollTop = chatPanel.scrollHeight;
}

// å­£åº¦ç»“æŸå¤„ç†
function endTurn() {
  // æ¶ˆè€—åŸºç¡€èµ„æº
  state.food -= 10;
  state.water -= 5;
  
  // æ£€æŸ¥é¥¥è’
  if (state.food <= 0) {
    state.food = 0;
    if (state.starving) {
      state.population -= 8;
      state.morale -= 20;
      appendChat("ğŸ¥€ é¥¥è’æŒç»­ï¼Œäººå£å‡å°‘ï¼Œå£«æ°”ä¸‹é™ã€‚", "event");
    } else {
      state.starving = true;
      appendChat("âš ï¸ é£Ÿç‰©è€—å°½ï¼Œå‡ºç°é¥¥è’ï¼", "event");
    }
  } else {
    state.starving = false;
  }
  
  // å­£åº¦æ¨è¿›
  state.season++;
  
  // éšæœºäº‹ä»¶
  if (Math.random() < 0.3) {
    handleEvents();
  }
  
  // æ›´æ–°ç•Œé¢
  updatePanels();
  showOptions();
  
  // é‡ç½®åŠ³åŠ¨åŠ›æ‘˜è¦
  document.getElementById("selectedCount").textContent = "0";
  document.getElementById("totalCost").textContent = "0";
  document.getElementById("laborSummary").classList.remove("labor-warning");
}

// å¤„ç†éšæœºäº‹ä»¶
function handleEvents() {
  const events = [
    {
      msg: "ğŸŒŠ æ´ªæ°´è¢­å‡»è¥åœ°ï¼é£Ÿç‰©å‡å°‘15ç‚¹",
      effect: () => { 
        state.food -= 15;
        state.morale -= 10;
      }
    },
    {
      msg: "ğŸ¤’ ç–¾ç—…åœ¨éƒ¨è½ä¸­æµè¡Œï¼äººå£å‡å°‘5äºº",
      effect: () => { 
        state.population -= 5;
        state.morale -= 15;
      }
    },
    {
      msg: "ğŸ”¥ éƒ¨è½å†…éƒ¨å‘ç”Ÿçº·äº‰ï¼å£«æ°”ä¸‹é™20ç‚¹",
      effect: () => { 
        state.morale -= 20;
      }
    },
    {
      msg: "ğŸ‰ éƒ¨è½åº†ç¥ä¸°æ”¶ï¼å£«æ°”ä¸Šå‡15ç‚¹ï¼Œé£Ÿç‰©å¢åŠ 10ç‚¹",
      effect: () => { 
        state.morale += 15;
        state.food += 10;
      }
    },
    {
      msg: "ğŸª¨ å‘ç°æ–°çš„ç‡§çŸ³çŸ¿è„‰ï¼å·¥å…·å¢åŠ 10ç‚¹ï¼ŒæŠ€æœ¯æå‡1ç‚¹",
      effect: () => { 
        state.tools += 10;
        state.tech += 1;
      }
    },
    {
      msg: "ğŸº ç‹¼ç¾¤è¢­å‡»è¥åœ°ï¼é£Ÿç‰©å‡å°‘10ç‚¹ï¼Œå£«æ°”ä¸‹é™10ç‚¹",
      effect: () => { 
        state.food -= 10;
        state.morale -= 10;
      }
    },
    {
      msg: "ğŸŒ§ï¸ æŒç»­å¹²æ—±ï¼æ°´æºå‡å°‘20ç‚¹",
      effect: () => { 
        state.water -= 20;
      }
    }
  ];
  
  const event = events[Math.floor(Math.random() * events.length)];
  event.effect();
  appendChat(event.msg, "event");
}

// æäº¤é€‰æ‹©å¹¶å¤„ç†å­£åº¦æ¨è¿›
document.getElementById("submitBtn").addEventListener("click", function() {
  const selectedOptions = document.querySelectorAll(".option-item.selected");
  
  // æ£€æŸ¥æ˜¯å¦æœ‰é€‰ä¸­é€‰é¡¹
  if (selectedOptions.length === 0) {
    appendChat("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªå‘å±•é€‰é¡¹", "event");
    return;
  }
  
  // è®¡ç®—æ€»åŠ³åŠ¨åŠ›æ¶ˆè€—
  let totalLabor = 0;
  selectedOptions.forEach(option => {
    totalLabor += parseInt(option.dataset.labor);
  });
  
  // æ£€æŸ¥åŠ³åŠ¨åŠ›æ˜¯å¦è¶³å¤Ÿ
  if (totalLabor > state.availableLabor) {
    appendChat(`é”™è¯¯ï¼šåŠ³åŠ¨åŠ›ä¸è¶³ï¼æ‰€éœ€: ${totalLabor}, å¯ç”¨: ${state.availableLabor}`, "event");
    return;
  }
  
  // æ‰§è¡Œé€‰ä¸­çš„è¡ŒåŠ¨
  selectedOptions.forEach(option => {
    const actionKey = option.dataset.key;
    actions[actionKey].exec();
    appendChat(`æ‰§è¡Œäº†: ${actions[actionKey].title}`);
  });
  
  // æ¨è¿›å­£åº¦
  endTurn();
  
  // æ·»åŠ AIåé¦ˆ
  appendChat("ä½œä¸ºé›†ä½“æ„å¿—ï¼Œæˆ‘å¼•å¯¼éƒ¨è½å‘æ›´é«˜çº§çš„ç¤¾ä¼šå½¢æ€å‘å±•...", "ai");
});

// åˆå§‹åŒ–æ¸¸æˆ
window.onload = initGame;
</script>
</body>
</html>
